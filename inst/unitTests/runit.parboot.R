
test.parboot.occu <- function() {
  
  set.seed(6546)
  R <- 20
  J <- 5
  z <- rbinom(R, 1, 0.6)
  y <- matrix(NA, R, J)
  y[] <- rbinom(R*J, 1, z*0.7)
  x1 <- rnorm(R)
  x2 <- y
  x2[] <- rnorm(R*J)
  x2[1,] <- NA
  x2[3,1] <- NA
  umf <- unmarkedFrameOccu(y=y, siteCovs=data.frame(x1=x1),
                           obsCovs=list(x2=x2))
  
  fitstats <- function(fm) {
    observed <- getY(fm@data)
    expected <- fitted(fm)
    resids <- residuals(fm)
    sse <- sum(resids^2,na.rm=TRUE)
    chisq <- sum((observed - expected)^2 / expected,na.rm=TRUE)
    freeTuke <- sum((sqrt(observed) - sqrt(expected))^2,na.rm=TRUE)
    out <- c(SSE=sse, Chisq=chisq, freemanTukey=freeTuke)
    return(out)
  }
  x.1 <- "x1"; x.2 <- "x2"
  frm.obj <- as.formula(paste("~", x.2, "~", x.1))
  fm1 <- occu(~x2 ~x1, umf)
  fm2 <- occu(frm.obj, umf)
  gof <- parboot(fm1, fitstats, nsim = 100, seed = 6546)
  gof2 <- parboot(fm2, fitstats, nsim = 100, seed = 6546)

  checkEquals(gof@t.star, gof2@t.star)
  checkEquals(gof@t.star,
              structure(c(19.5618449798627, 17.4002359377683, 17.9537040353665, 
                          21.075371921093, 16.0962042909353, 20.325552699814, 23.7198566870693, 
                          19.5108924194316, 19.8642253546241, 21.5327320826537, 21.1187621901383, 
                          16.7956032348677, 22.0287240694084, 22.3480005863275, 18.7973008017797, 
                          23.1214849443085, 13.3506204184759, 21.5072703730266, 20.4061806452888, 
                          14.6052617734126, 18.8706802331149, 13.0708994826577, 20.1372507635082, 
                          14.6298678460545, 14.6057681371775, 18.831780320931, 17.120219947307, 
                          19.4171670630644, 21.4957335846724, 22.4888402383621, 12.322613247868, 
                          21.5454567695879, 14.6852414309207, 19.7838342994475, 17.8245593195829, 
                          22.1969431231403, 17.7606626580712, 19.3546579192266, 20.2796878074241, 
                          13.1625669588524, 20.1565567700057, 18.4624537665433, 18.7281497995722, 
                          17.084276968227, 18.7749912147129, 21.51782846093, 22.7333831188702, 
                          16.5775111637824, 18.2032322719839, 22.4139063387728, 15.9946392373616, 
                          15.5915117285785, 21.19490854222, 17.827591586556, 21.3012334843756, 
                          21.6488943962608, 17.6126714952445, 18.8307613494122, 20.1703098549003, 
                          15.1625669579498, 19.826946456208, 15.7205534649991, 20.3656552130317, 
                          16.2150934276948, 21.751225967568, 19.1377654709796, 18.4258360327573, 
                          21.7833681303917, 21.0655247805897, 21.9629466970292, 16.6242076104607, 
                          15.1981816691142, 12.5702905066807, 19.6157287827686, 20.9402336996149, 
                          14.7123207579701, 21.4435346035415, 22.203853561449, 19.3693120876226, 
                          18.541012442289, 20.8523885801662, 17.5557349612729, 21.1092291315395, 
                          15.3409036607707, 22.2534589622124, 19.3384363437181, 13.0019012153355, 
                          18.4330918039649, 21.6586617051047, 17.881798324457, 22.6601416905637, 
                          18.616287158617, 19.0554188699823, 17.4220384268791, 16.7061405736726, 
                          22.6182783715741, 22.1268109325025, 21.9230866316946, 15.2082641262436, 
                          18.0812577912096, 43.3811085710622, 45.9748066338993, 53.1267194500903, 
                          53.9226412608954, 57.2322853419496, 56.81913797575, 42.843092859435, 
                          71.645827922274, 54.9269841336055, 50.0243834249273, 49.4273985801733, 
                          43.0939544330471, 55.7119685217531, 55.2558872423902, 47.7870495776912, 
                          52.6225653375692, 21.1044790363835, 60.7708658750924, 59.9864660260814, 
                          48.158395289865, 61.7457993539094, 37.0625570895648, 50.1620681411728, 
                          107.147790014673, 75.8456014881641, 73.1799441669325, 66.5580949970634, 
                          66.5923835657879, 43.2525590763885, 49.6312006043033, 50.1301251225221, 
                          52.8556920360704, 52.4751938312775, 56.4790071460586, 36.8647563645067, 
                          59.2938627030736, 67.4047022626281, 52.9528060465144, 59.4117890330828, 
                          96.5345848217843, 45.0662041888096, 61.9689590696746, 46.7435460147703, 
                          66.1761660198351, 52.9320582824706, 61.4889836317416, 55.9574703456775, 
                          37.8266167880213, 96.8599350204107, 69.2816343189622, 47.3277238738376, 
                          42.3484674062992, 56.7952852409591, 65.6088755086021, 58.8365068950566, 
                          48.1777438550257, 57.793775564308, 77.6740293003584, 68.5207148634468, 
                          62.0601548039289, 59.0183338904649, 62.2703649855977, 49.8261111448057, 
                          64.8256636904662, 48.3927867616504, 61.4841796026201, 73.88006108371, 
                          51.8816936520876, 48.5461720712801, 56.9866166106678, 69.3993834402648, 
                          54.8704280205806, 53.7461657636567, 67.1426253749932, 59.4522997378742, 
                          53.9775639251258, 51.8880881698028, 46.7652137312378, 54.7160400929552, 
                          82.1622240570002, 63.4847263649612, 48.2103917727117, 55.0178942648036, 
                          55.6473439310099, 54.3938693100806, 71.9583575909036, 85.4748087238452, 
                          73.3103805543379, 67.6745322247688, 46.5483213094101, 62.9901631672752, 
                          66.978261744477, 68.6352895991559, 36.229360963399, 65.2150267164381, 
                          50.5686157431811, 55.6084482038548, 52.2075884629467, 38.1507417643389, 
                          53.4129283520586, 23.2664577864302, 21.0750583945179, 22.6262152397489, 
                          26.0567150448873, 20.4403218751078, 25.7594470302298, 26.5121247843041, 
                          24.209733661715, 24.9785133948159, 25.5169785617333, 24.9847874670303, 
                          20.1061010934685, 26.9129640852366, 26.5874571048698, 22.8912318274687, 
                          27.262379925334, 14.9143114366755, 25.8352685143758, 24.6913130913828, 
                          18.237633777394, 23.8829720420229, 15.5867212282945, 24.7824806665662, 
                          19.620841205235, 19.2916899251373, 22.839576313349, 21.7274734394576, 
                          22.2922040497901, 25.2604485627385, 26.5400357020065, 16.1731884602148, 
                          26.1384672346904, 17.5893536807727, 24.5020407308938, 21.8260195910276, 
                          27.1746057194612, 23.3287029690398, 23.5276963545107, 24.8954041928928, 
                          18.4758269380415, 23.5954906760685, 21.6370332727459, 23.0349712484037, 
                          22.2194937217677, 23.1543976924809, 25.8737217459936, 27.8513283250486, 
                          19.6965071514396, 23.0268570741737, 28.0677719124672, 19.8840377834397, 
                          18.4603389863306, 25.8298086845132, 23.2485637347826, 25.9168966206968, 
                          26.1887756301694, 22.0435838347155, 22.4088635238283, 24.4074264892885, 
                          20.8130191441585, 23.961059426556, 19.9071500178624, 24.9198338755164, 
                          20.3318469099804, 25.7014219567935, 23.1867285598034, 23.6312172996782, 
                          26.0231017648937, 25.5379206389201, 26.930788231955, 22.4731473297016, 
                          20.2329929484612, 16.6778609896376, 25.1297713236246, 26.5495503537427, 
                          18.9205151612852, 26.2004914124675, 25.9815529035957, 23.9187162955908, 
                          23.4859888111333, 26.7429680608443, 20.9712900937786, 25.9103649128181, 
                          19.4568163614539, 27.2478522089053, 24.8188282021128, 17.6645199950128, 
                          23.0689346700379, 26.9644431478494, 21.2922969391002, 27.1491334558255, 
                          24.3752059401432, 23.4504323299462, 20.5969557152295, 21.8180949333664, 
                          26.4219322965689, 26.974047815842, 26.5215425452644, 18.5907018551572, 
                          22.1663811466474), .Dim = c(100L, 3L), 
                        .Dimnames = list(NULL, c("SSE", "Chisq", "freemanTukey"))))
}
